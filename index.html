<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Highstock s Binance API</title>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	
    <!-- Načítanie Highcharts knižníc z verejného CDN -->
    <!-- 
    <script src="https://high-stock-123.vercel.app/highstock.js"></script>
    <script src="https://high-stock-123.vercel.app/highcharts-more.js"></script>
    <script src="https://high-stock-123.vercel.app/exporting.js"></script>
    <script src="https://high-stock-123.vercel.app/data.js"></script>
    <script src="https://high-stock-123.vercel.app/accessibility.js"></script>
    <script src="https://high-stock-123.vercel.app/annotations.js"></script>
    <script src="https://high-stock-123.vercel.app/annotations-advanced.js"></script>
    <script src="https://high-stock-123.vercel.app/drag-panes.js"></script>
    <script src="https://high-stock-123.vercel.app/full-screen.js"></script>
    <script src="https://high-stock-123.vercel.app/indicators-all.js"></script>
    <script src="https://high-stock-123.vercel.app/stock-tools.js"></script>
    -->

    <script src="https://high-stock-123.vercel.app/highstock.js"></script>
    <script src="https://high-stock-123.vercel.app/drag-panes.js"></script>
    <script src="https://high-stock-123.vercel.app/indicators-all.js"></script>
    <script src="https://high-stock-123.vercel.app/annotations-advanced.js"></script>
    <script src="https://high-stock-123.vercel.app/full-screen.js"></script>
    <script src="https://high-stock-123.vercel.app/price-indicator.js"></script>
    <script src="https://high-stock-123.vercel.app/accessibility.js"></script>


    <!--
        <script src="https://high-stock-123.vercel.app/exporting.js"></script>
        <script src="https://high-stock-123.vercel.app/adaptive.js"></script>
    -->

    <script src="https://high-stock-123.vercel.app/stock-tools.js"></script>
    <script src="https://high-stock-123.vercel.app/dark-unica.js"></script>


    <!-- CSS téma Highcharts 'stock-css-design' -->
    <link rel="stylesheet" type="text/css" href="https://high-stock-123.vercel.app/highcharts.css">
    <link rel="stylesheet" type="text/css" href="https://high-stock-123.vercel.app/mojstyle.css">
    <link rel="stylesheet" type="text/css" href="https://high-stock-123.vercel.app/mojstyle_new.css">
    <link rel="stylesheet" type="text/css" href="https://high-stock-123.vercel.app/popup.css">
    <!-- <link rel="stylesheet" type="text/css" href="https://high-stock-123.vercel.app/gui.css"> -->
    <link rel="stylesheet" type="text/css" href="https://high-stock-123.vercel.app/dark-unica.css">

    <!-- Načítanie Tailwind CSS pre moderný dizajn -->
    <!-- 
    <script src="https://cdn.tailwindcss.com"></script>
    -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">


</head>
<body>


    <div class="controls-container">
        <input type="text" id="symbolInput" placeholder="Zadajte symbol (napr. BTCUSDT)" value="BTCUSDT">
        <button id="loadDataButton">Načítať dáta</button>
    </div>

    <div class="chart-wrapper">
        <div class="highcharts-popup highcharts-popup-indicators">
            <span class="highcharts-close-popup">&times;</span>
            <div class="highcharts-popup-wrapper">
                <label for="indicator-list">Indicator</label>
                <select name="indicator-list">
                    <option value="sma">SMA</option>
                    <option value="ema">EMA</option>
                    <option value="bb">Bollinger bands</option>
                </select>
                <label for="stroke">Period</label>
                <input type="text" name="period" value="14" />
            </div>
            <button>Add</button>
        </div>
        <div class="highcharts-popup highcharts-popup-annotations">
            <span class="highcharts-close-popup">&times;</span>
            <div class="highcharts-popup-wrapper">
                <label for="stroke">Color</label>
                <input type="text" name="stroke" />
                <label for="stroke-width">Width</label>
                <input type="text" name="stroke-width" />
            </div>
            <button>Save</button>
        </div>
        <div class="highcharts-stocktools-wrapper highcharts-bindings-container highcharts-bindings-wrapper">
            <div class="highcharts-menu-wrapper">
                <ul class="highcharts-stocktools-toolbar stocktools-toolbar">
                    <li class="highcharts-indicators" title="Indicators">
                        <span class="highcharts-menu-item-btn"></span>
                        <span class="highcharts-menu-item-title">Indicators</span>
                    </li>
                    <li class="highcharts-label-annotation" title="Simple shapes">
                        <span class="highcharts-menu-item-btn"></span>
                        <span class="highcharts-menu-item-title">Shapes</span>
                        <span class="highcharts-submenu-item-arrow highcharts-arrow-right"></span>
                        <ul class="highcharts-submenu-wrapper">
                            <li class="highcharts-label-annotation" title="Label">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Label</span>
                            </li>
                            <li class="highcharts-circle-annotation" title="Circle">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Circle</span>
                            </li>
                            <li class="highcharts-rectangle-annotation " title="Rectangle">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Rectangle</span>
                            </li>
                            <li class="highcharts-ellipse-annotation" title="Ellipse">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Ellipse</span>
                            </li>
                        </ul>
                    </li>
                    <li class="highcharts-segment" title="Lines">
                        <span class="highcharts-menu-item-btn"></span>
                        <span class="highcharts-menu-item-title">Lines</span>
                        <span class="highcharts-submenu-item-arrow highcharts-arrow-right"></span>
                        <ul class="highcharts-submenu-wrapper">
                            <li class="highcharts-segment" title="Segment">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Segment</span>
                            </li>
                            <li class="highcharts-arrow-segment" title="Arrow segment">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Arrow segment</span>
                            </li>
                            <li class="highcharts-ray" title="Ray">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Ray</span>
                            </li>
                            <li class="highcharts-arrow-ray" title="Arrow ray">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Arrow ray</span>
                            </li>
                            <li class="highcharts-infinity-line" title="Line">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Line</span>
                            </li>
                            <li class="highcharts-arrow-infinity-line" title="Arrow line">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Arrow</span>
                            </li>
                            <li class="highcharts-horizontal-line" title="Horizontal line">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Horizontal</span>
                            </li>
                            <li class="highcharts-vertical-line" title="Vertical line">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Vertical</span>
                            </li>
                        </ul>
                    </li>
                    <!--                     
                        <li class="highcharts-elliott3" title="Crooked lines">
                            <span class="highcharts-menu-item-btn"></span>
                            <span class="highcharts-menu-item-title">Crooked lines</span>
                            <span class="highcharts-submenu-item-arrow highcharts-arrow-right"></span>
                            <ul class="highcharts-submenu-wrapper">
                                <li class="highcharts-elliott3" title="Elliott 3 line">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Elliot 3</span>
                                </li>
                                <li class="highcharts-elliott5" title="Elliott 5 line">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Elliot 5</span>
                                </li>
                                <li class="highcharts-crooked3" title="Crooked 3 line">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Crooked 3</span>
                                </li>
                                <li class="highcharts-crooked5" title="Crooked 5 line">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Crooked 5</span>
                                </li>
                            </ul>
                        </li>
                        <li class="highcharts-measure-xy" title="Measure">
                            <span class="highcharts-menu-item-btn"></span>
                            <span class="highcharts-menu-item-title">Measure</span>
                            <span class="highcharts-submenu-item-arrow highcharts-arrow-right"></span>
                            <ul class="highcharts-submenu-wrapper">
                                <li class="highcharts-measure-xy" title="Measure XY">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Measure XY</span>
                                </li>
                                <li class="highcharts-measure-x" title="Measure X">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Measure X</span>
                                </li>
                                <li class="highcharts-measure-y" title="Measure Y">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Measure Y</span>
                                </li>
                            </ul>
                        </li>
                        <li class="highcharts-fibonacci" title="Advanced">
                            <span class="highcharts-menu-item-btn"></span>
                            <span class="highcharts-menu-item-title">Advanced</span>
                            <span class="highcharts-submenu-item-arrow highcharts-arrow-right"></span>
                            <ul class="highcharts-submenu-wrapper">
                                <li class="highcharts-fibonacci" title="Fibonacci">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Fibonacci</span>
                                </li>
                                <li class="highcharts-pitchfork" title="Pitchfork">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Pitchfork</span>
                                </li>
                                <li class="highcharts-parallel-channel" title="Parallel channel">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Parallel channel</span>
                                </li>
                            </ul>
                        </li>
                        <li class="highcharts-vertical-counter" title="Vertical labels">
                            <span class="highcharts-menu-item-btn"></span>
                            <span class="highcharts-menu-item-title">Counters</span>
                            <span class="highcharts-submenu-item-arrow highcharts-arrow-right"></span>
                            <ul class="highcharts-submenu-wrapper">
                                <li class="highcharts-vertical-counter" title="Vertical counter">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Counter</span>
                                </li>
                                <li class="highcharts-vertical-label" title="Vertical label">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Label</span>
                                </li>
                                <li class="highcharts-vertical-arrow" title="Vertical arrow">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Arrow</span>
                                </li>
                            </ul>
                        </li>
                        <li class="highcharts-flag-circlepin" title="Flags">
                            <span class="highcharts-menu-item-btn"></span>
                            <span class="highcharts-menu-item-title">Flags</span>
                            <span class="highcharts-submenu-item-arrow highcharts-arrow-right"></span>
                            <ul class="highcharts-submenu-wrapper">
                                <li class="highcharts-flag-circlepin" title="Flag circle">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Circle</span>
                                </li>
                                <li class="highcharts-flag-diamondpin" title="Flag diamond">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Diamond</span>
                                </li>
                                <li class="highcharts-flag-squarepin" title="Flag square">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Square</span>
                                </li>
                                <li class="highcharts-flag-simplepin" title="Flag simple">
                                    <span class="highcharts-menu-item-btn"></span>
                                    <span class="highcharts-menu-item-title">Simple</span>
                                </li>
                            </ul>
                        </li> 
                   

                    <li class="highcharts-series-type-ohlc" title="Type change">
                        <span class="highcharts-menu-item-btn"></span>
                        <span class="highcharts-menu-item-title">Series type</span>
                        <span class="highcharts-submenu-item-arrow highcharts-arrow-right"></span>
                        <ul class="highcharts-submenu-wrapper">
                            <li class="highcharts-series-type-ohlc" title="OHLC">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">OHLC</span>
                            </li>
                            <li class="highcharts-series-type-line" title="Line">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Line</span>
                            </li>
                            <li class="highcharts-series-type-candlestick" title="Candlestick">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Candlestick</span>
                            </li>
                        </ul>
                    </li>
                    <li class="highcharts-save-chart right" title="Save chart">
                        <span class="highcharts-menu-item-btn"></span>
                    </li>
                    <li class="highcharts-full-screen right" title="Fullscreen">
                        <span class="highcharts-menu-item-btn"></span>
                    </li>
                    <li class="highcharts-zoom-x right" title="Zoom change">
                        <span class="highcharts-menu-item-btn"></span>
                        <span class="highcharts-submenu-item-arrow highcharts-arrow-right"></span>
                        <ul class="highcharts-submenu-wrapper">
                            <li class="highcharts-zoom-x" title="Zoom X">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Zoom X</span>
                            </li>
                            <li class="highcharts-zoom-y" title="Zoom Y">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Zoom Y</span>
                            </li>
                            <li class="highcharts-zoom-xy" title="Zooom XY">
                                <span class="highcharts-menu-item-btn"></span>
                                <span class="highcharts-menu-item-title">Zoom XY</span>
                            </li>
                        </ul>
                    </li>
                -->

                    <li class="highcharts-current-price-indicator right" title="Current Price Indicators">
                        <span class="highcharts-menu-item-btn"></span>
                    </li>
                    <li class="highcharts-toggle-annotations right" title="Toggle annotations">
                        <span class="highcharts-menu-item-btn"></span>
                    </li>
                </ul>
            </div>
        </div>
        <div id="container" class="chart"></div>
    </div>


    <script type="text/javascript">
        (async () => {

            function addPopupEvents(chart) {
                const closePopupButtons = document.getElementsByClassName(
                    'highcharts-close-popup'
                );
                // Close popup button:
                Highcharts.addEvent(
                    closePopupButtons[0],
                    'click',
                    function () {
                        this.parentNode.style.display = 'none';
                    }
                );

                Highcharts.addEvent(
                    closePopupButtons[1],
                    'click',
                    function () {
                        this.parentNode.style.display = 'none';
                    }
                );

                // Add an indicator from popup
                Highcharts.addEvent(
                    document.querySelectorAll('.highcharts-popup-indicators button')[0],
                    'click',
                    function () {
                        const typeSelect = document.querySelectorAll(
                            '.highcharts-popup-indicators select'
                        )[0],
                            type = typeSelect.options[typeSelect.selectedIndex].value,
                            period = document.querySelectorAll(
                                '.highcharts-popup-indicators input'
                            )[0].value || 14;

                        chart.addSeries({
                            linkedTo: 'symbol-ohlc',
                            type: type,
                            params: {
                                period: parseInt(period, 10)
                            }
                        });

                        chart.stockToolbar.indicatorsPopupContainer.style.display =
                            'none';
                    }
                );

                // Update an annotation from popup
                Highcharts.addEvent(
                    document.querySelectorAll(
                        '.highcharts-popup-annotations ' +
                        'button'
                    )[0],
                    'click',
                    function () {
                        const strokeWidth = parseInt(
                            document.querySelectorAll(
                                '.highcharts-popup-annotations ' +
                                'input[name="stroke-width"]'
                            )[0].value,
                            10
                        ),
                            strokeColor = document.querySelectorAll(
                                '.highcharts-popup-annotations input[name="stroke"]'
                            )[0].value;

                        // Stock/advanced annotations have common options under
                        // typeOptions
                        if (chart.currentAnnotation.options.typeOptions) {
                            chart.currentAnnotation.update({
                                typeOptions: {
                                    lineColor: strokeColor,
                                    lineWidth: strokeWidth,
                                    line: {
                                        strokeWidth: strokeWidth,
                                        stroke: strokeColor
                                    },
                                    background: {
                                        strokeWidth: strokeWidth,
                                        stroke: strokeColor
                                    },
                                    innerBackground: {
                                        strokeWidth: strokeWidth,
                                        stroke: strokeColor
                                    },
                                    outerBackground: {
                                        strokeWidth: strokeWidth,
                                        stroke: strokeColor
                                    },
                                    connector: {
                                        strokeWidth: strokeWidth,
                                        stroke: strokeColor
                                    }
                                }
                            });
                        } else {
                            // Basic annotations:
                            chart.currentAnnotation.update({
                                shapes: [{
                                    'stroke-width': strokeWidth,
                                    stroke: strokeColor
                                }],
                                labels: [{
                                    borderWidth: strokeWidth,
                                    borderColor: strokeColor
                                }]
                            });
                        }
                        chart.stockToolbar.annotationsPopupContainer.style.display =
                            'none';
                    }
                );
            }

            // Funkcia na načítanie dát z Binance API
            async function fetchData(symbol) {
                const url = `https://api.binance.com/api/v3/klines?symbol=${symbol.toUpperCase()}&interval=1d&limit=1000`;
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('Chyba pri načítaní dát z Binance API:', error);
                    return null;
                }
            }

            let highchart;

            // Funkcia na vytvorenie alebo aktualizáciu grafu
            async function createOrUpdateChart(symbol) {
                const rawData = await fetchData(symbol);

                if (!rawData) {
                    if (highchart) {
                        highchart.destroy();
                        document.getElementById('container').innerHTML = '<p style="text-align: center; color: red;">Nepodarilo sa načítať dáta pre symbol: ' + symbol + '</p>';
                    }
                    return;
                }

                const ohlc = [],
                    volume = [];

                for (let i = 0; i < rawData.length; i += 1) {
                    ohlc.push([
                        rawData[i][0], // the date
                        parseFloat(rawData[i][1]), // open
                        parseFloat(rawData[i][2]), // high
                        parseFloat(rawData[i][3]), // low
                        parseFloat(rawData[i][4]) // close
                    ]);

                    volume.push([
                        rawData[i][0], // the date
                        parseFloat(rawData[i][5]) // the volume
                    ]);
                }

                if (highchart) {
                    // Aktualizácia existujúceho grafu
                    highchart.series[0].update({
                        name: `${symbol.toUpperCase()} Stock Price`,
                        data: ohlc
                    });
                    highchart.series[1].update({
                        name: `${symbol.toUpperCase()} Volume`,
                        data: volume
                    });
                } else {
                    // Vytvorenie nového grafu
                    highchart = Highcharts.stockChart('container', {
                        chart: {
                            events: {
                                load: function () {
                                    addPopupEvents(this);
                                }
                            }
                        },
                        rangeSelector: {
                            selected: 1
                        },
                        yAxis: [{
                            labels: {
                                align: 'left'
                            },
                            height: '80%',
                            resize: {
                                enabled: true
                            }
                        }, {
                            labels: {
                                align: 'left'
                            },
                            top: '80%',
                            height: '20%',
                            offset: 0
                        }],
                        navigationBindings: {
                            events: {
                                selectButton: function (event) {
                                    let newClassName = event.button.className + ' ' +
                                        'highcharts-active';
                                    const topButton = event.button.parentNode.parentNode;

                                    if (topButton.classList.contains('right')) {
                                        newClassName += ' right';
                                    }

                                    if (!topButton.classList.contains(
                                        'highcharts-menu-wrapper'
                                    )) {
                                        topButton.className = newClassName;
                                    }

                                    this.chart.activeButton = event.button;
                                },
                                deselectButton: function (event) {
                                    event.button.parentNode.parentNode.classList.remove(
                                        'highcharts-active'
                                    );
                                    this.chart.activeButton = null;
                                },
                                showPopup: function (event) {
                                    if (!this.indicatorsPopupContainer) {
                                        this.indicatorsPopupContainer = document
                                            .getElementsByClassName(
                                                'highcharts-popup-indicators'
                                            )[0];
                                    }

                                    if (!this.annotationsPopupContainer) {
                                        this.annotationsPopupContainer = document
                                            .getElementsByClassName(
                                                'highcharts-popup-annotations'
                                            )[0];
                                    }

                                    if (event.formType === 'indicators') {
                                        this.indicatorsPopupContainer.style.display = 'block';
                                    } else if (event.formType === 'annotation-toolbar') {
                                        if (!this.chart.activeButton) {
                                            this.chart.currentAnnotation = event.annotation;
                                            this.annotationsPopupContainer.style.display =
                                                'block';
                                        }
                                    }
                                },
                                closePopup: function () {
                                    this.indicatorsPopupContainer.style.display = 'none';
                                    this.annotationsPopupContainer.style.display = 'none';
                                }
                            }
                        },
                        stockTools: {
                            gui: {
                                enabled: false
                            }
                        },
                        series: [{
                            type: 'candlestick',
                            id: 'symbol-ohlc',
                            name: `${symbol.toUpperCase()} Stock Price`,
                            data: ohlc
                        }, {
                            type: 'column',
                            id: 'symbol-volume',
                            name: `${symbol.toUpperCase()} Volume`,
                            data: volume,
                            yAxis: 1
                        }],
                        responsive: {
                            rules: [{
                                condition: {
                                    maxWidth: 800
                                },
                                chartOptions: {
                                    rangeSelector: {
                                        inputEnabled: false
                                    }
                                }
                            }]
                        }
                    });
                }
            }
            
            // Načítanie dát po kliknutí na tlačidlo
            document.getElementById('loadDataButton').addEventListener('click', () => {
                const symbol = document.getElementById('symbolInput').value.trim();
                if (symbol) {
                    createOrUpdateChart(symbol);
                } else {
                    document.getElementById('container').innerHTML = '<p style="text-align: center; color: red;">Prosím, zadajte symbol.</p>';
                }
            });

            // Načítanie počiatočného grafu pri prvom načítaní stránky
            createOrUpdateChart(document.getElementById('symbolInput').value.trim());

        })();
    </script>
</body>
</html>
